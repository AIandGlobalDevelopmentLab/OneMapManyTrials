bootstrap: docker
from: nvcr.io/nvidia/pytorch:22.10-py3

%files
    requirements.txt /tmp/requirements.txt

%post
    # Make sure to use the correct jupyter config
    if [ -d /opt/conda/etc/jupyter ]; then
        rm -f /opt/conda/etc/jupyter/jupyter_notebook_config.py
        rm -f /opt/conda/etc/jupyter/jupyter_notebook_config.json
    fi

    # Install code-server
    apt update
    apt install curl -y
    curl -fsSL https://code-server.dev/install.sh | sh
    
    # Install Python dependencies
    pip install \
    pytorch-lightning==2.0.8 \
    webdataset==0.2.48 \
    seaborn==0.12.2 \
    rasterio==1.3.8 \
    earthengine-api==0.1.368 \
    retry==0.9.2 \
    wandb==0.15.10 \
    fairscale==0.4.13 \
    einops==0.6.1 \
    transformers==4.33.1 \
    datasets==2.14.5 \
    mmap_ninja==0.7.3 \
    timm==0.6.12 \
    lightgbm==4.6.0 \
    xgboost==1.6.1 \
    torchgeo==0.4.1 \
    quantile-forest==1.3.11 \
    mapboxgl==0.10.2 \
    h5py==3.11.0 \
    geopandas==0.13.2